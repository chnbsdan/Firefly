---
import { musicPlayerConfig } from "@/config/musicConfig";
import { url } from "@/utils/url-utils";

const config = musicPlayerConfig;

// é¢„å…ˆç”Ÿæˆæœ¬åœ°èµ„æºè·¯å¾„ï¼Œç¡®ä¿åœ¨éæ ¹ç›®å½•éƒ¨ç½²æ—¶ä¹Ÿèƒ½æ­£ç¡®åŠ è½½
const aplayerCssPath = url("/assets/css/APlayer.min.css");
const aplayerCustomCssPath = url("/assets/css/APlayer.custom.css");
const aplayerJsPath = url("/assets/js/APlayer.min.js");

// MetingJS è·¯å¾„å¤„ç†
const metingJsPath = config.meting?.jsPath
  ? (config.meting.jsPath.startsWith("http://") || config.meting.jsPath.startsWith("https://"))
    ? config.meting.jsPath
    : url(config.meting.jsPath)
  : "https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js";

// é¢„å¤„ç†æœ¬åœ°éŸ³ä¹åˆ—è¡¨çš„è·¯å¾„
const processedLocalPlaylist = config.mode === "local" && config.local?.playlist
  ? config.local.playlist.map((song) => ({
      ...song,
      url: url(song.url),
      cover: song.cover ? url(song.cover) : undefined,
      lrc: song.lrc ? url(song.lrc) : undefined,
    }))
  : null;
---

{config.enable && (
  <>
    <!-- APlayer CSS -->
    <link rel="stylesheet" href={aplayerCssPath} />
    <link rel="stylesheet" href={aplayerCustomCssPath} />

    <!-- éŸ³ä¹èƒ¶å›Š -->
    <div id="music-capsule" class="music-capsule" title="ç‚¹å‡»å±•å¼€æ’­æ”¾å™¨">
      <img id="capsule-cover" src="https://p2.music.126.net/4HGEnXVexEfF2M4WdDdfrQ==/109951166354363385.jpg" alt="ä¸“è¾‘å°é¢" />
      <!-- é»‘èƒ¶å”±ç‰‡æ»‘åŠ¨æ† -->
      <div class="vinyl-arm">
        <div class="arm-base"></div>
        <div class="arm-rod"></div>
        <div class="arm-head"></div>
      </div>
    </div>

    <!-- ç‹¬ç«‹æ­Œè¯æ˜¾ç¤º -->
    <div id="floating-lyrics" class="floating-lyrics">
      <div class="current-line"></div>
      <div class="next-line"></div>
    </div>

    <!-- æ’­æ”¾å™¨å®¹å™¨ -->
    <div id="player-wrap" aria-hidden="true">
      <div id="aplayer-container" class:mobile-hide={config.responsive?.mobile?.hide}></div>
    </div>

    <!-- å³é”®èœå• -->
    <ul id="right-menu" role="menu" aria-hidden="true">
      <!-- æ–°å¢çš„å¯¼èˆªå›¾æ ‡æ  -->
      <li class="nav-icons">
        <span class="nav-icon" id="nav-back">â†</span>
        <span class="nav-icon" id="nav-forward">â†’</span>
        <span class="nav-icon" id="nav-refresh">â†»</span>
        <span class="nav-icon" id="nav-top">â†‘</span>
      </li>
      <li id="menu-play">â–¶ æ’­æ”¾ / æš‚åœ</li>
      <li id="menu-prev">â® ä¸Šä¸€é¦–</li>
      <li id="menu-next">â­ ä¸‹ä¸€é¦–</li>
      <li id="menu-volup">ğŸ”Š éŸ³é‡ +</li>
      <li id="menu-voldown">ğŸ”‰ éŸ³é‡ -</li>
      <li id="menu-lyrics">ğŸ“œ æ˜¾ç¤º/éšè—æ­Œè¯</li>
      <!-- æ–°å¢çš„ä¸¤ä¸ªèœå•é¡¹ -->
      <li id="menu-random">ğŸ² éšå˜é€›é€›</li>
      <li id="menu-home">ğŸ  å›ä¸»é¡µ</li>
      <li id="menu-support">ğŸ’¡ æŠ€æœ¯æ”¯æŒ</li>
      <li id="menu-fullscreen">ğŸ–¥ï¸ å…¨å±æ¨¡å¼</li>
      <li id="menu-close">âŒ å…³é—­æ’­æ”¾å™¨</li>
    </ul>
  </>
)}

<script define:vars={{ config, aplayerJsPath, metingJsPath, processedLocalPlaylist }} is:inline>
  (function() {
    if (!config.enable) return;
    if (typeof window === 'undefined') return;

    // çŠ¶æ€å˜é‡
    let lyricsVisible = localStorage.getItem('lyricsVisible') !== 'false';
    let metingEl = null;
    let aplayer = null;
    let lyricsInterval = null;
    let currentLyric = '';
    let lyricsEnabled = false;
    let fallbackLyricsMode = false;
    let currentSongInfo = null;

    // DOM å¼•ç”¨
    const capsule = document.getElementById('music-capsule');
    const capsuleCover = document.getElementById('capsule-cover');
    const playerWrap = document.getElementById('player-wrap');
    const aplayerContainer = document.getElementById('aplayer-container');
    const rightMenu = document.getElementById('right-menu');
    const floatingLyrics = document.getElementById('floating-lyrics');
    const currentLineEl = floatingLyrics?.querySelector('.current-line');
    const nextLineEl = floatingLyrics?.querySelector('.next-line');

    console.log('éŸ³ä¹æ’­æ”¾å™¨åˆå§‹åŒ–å¼€å§‹');
    console.log('æ­Œè¯é…ç½®:', config.player?.lrcType);
    console.log('æ­Œè¯æ˜¾ç¤ºçŠ¶æ€:', lyricsVisible);

    // åˆå§‹åŒ–éŸ³ä¹æ’­æ”¾å™¨
    function initMeting(){
      if (aplayer) return Promise.resolve(aplayer);
      return new Promise((resolve, reject) => {
        if (metingEl && metingEl.aplayer) {
          aplayer = metingEl.aplayer;
          bindAPlayerEvents(aplayer);
          return resolve(aplayer);
        }

        // åˆ›å»º meting-js å…ƒç´ 
        aplayerContainer.innerHTML = '';
        
        if (config.mode === "meting" && config.meting) {
          metingEl = document.createElement('meting-js');
          metingEl.setAttribute('server', config.meting.server || 'netease');
          metingEl.setAttribute('type', config.meting.type || 'playlist');
          metingEl.setAttribute('id', config.meting.id || '');
          metingEl.setAttribute('api', config.meting.api || '');
          metingEl.setAttribute('fixed', (config.player?.fixed ?? true) ? 'true' : 'false');
          metingEl.setAttribute('mini', (config.player?.mini ?? true) ? 'true' : 'false');
          metingEl.setAttribute('autoplay', config.player?.autoplay ? 'true' : 'false');
          metingEl.setAttribute('theme', config.player?.theme || '#b7daff');
          metingEl.setAttribute('loop', config.player?.loop || 'all');
          metingEl.setAttribute('order', config.player?.order || 'list');
          metingEl.setAttribute('preload', config.player?.preload || 'auto');
          metingEl.setAttribute('volume', String(config.player?.volume ?? 0.7));
          metingEl.setAttribute('mutex', config.player?.mutex !== false ? 'true' : 'false');
          // å¼ºåˆ¶å¯ç”¨æ­Œè¯
          metingEl.setAttribute('lrc-type', '3');
          metingEl.setAttribute('showlrc', '1');
          metingEl.setAttribute('lrc', '1');
          metingEl.setAttribute('list-folded', config.player?.listFolded ? 'true' : 'false');
          metingEl.setAttribute('list-max-height', config.player?.listMaxHeight || '340px');
          metingEl.setAttribute('storage-name', config.player?.storageName || 'aplayer-setting');
        }

        if (metingEl) {
          aplayerContainer.appendChild(metingEl);
          console.log('MetingJS å…ƒç´ å·²åˆ›å»º');
        }

        // ç­‰å¾…æ¸²æŸ“å®Œæˆ
        let handled = false;
        function tryResolve(){
          if (handled) return;
          if (metingEl && metingEl.aplayer) {
            aplayer = metingEl.aplayer;
            handled = true;
            console.log('APlayer å®ä¾‹å·²åˆ›å»º:', aplayer);
            
            // å¼ºåˆ¶å¯ç”¨æ­Œè¯æ˜¾ç¤º
            setTimeout(() => {
              if (aplayer.lrc && typeof aplayer.lrc.show === 'function') {
                aplayer.lrc.show();
                lyricsEnabled = true;
                console.log('æ­Œè¯æ˜¾ç¤ºå·²å¯ç”¨');
              }
            }, 1000);
            
            bindAPlayerEvents(aplayer);
            resolve(aplayer);
          }
        }
        
        if (metingEl) {
          metingEl.addEventListener('rendered', tryResolve);
        }
        
        const poll = setInterval(()=>{ 
          tryResolve(); 
          if(handled) clearInterval(poll); 
        }, 300);
        
        setTimeout(()=>{ 
          if(!handled){ 
            clearInterval(poll); 
            reject(new Error('APlayer åˆå§‹åŒ–è¶…æ—¶')); 
          }
        }, 15000);
      });
    }

    // ç»‘å®š APlayer äº‹ä»¶
    function bindAPlayerEvents(ap){
      if (!ap) return;
      
      console.log('ç»‘å®š APlayer äº‹ä»¶');
      
      function updateCover(){
        try {
          const info = ap.list.audios[ap.list.index];
          if (info && info.cover && capsuleCover) {
            capsuleCover.src = info.cover;
          }
        } catch(e){
          console.log('æ›´æ–°å°é¢å¤±è´¥:', e);
        }
      }
      
      ap.on('loadeddata', function() {
        console.log('éŸ³é¢‘æ•°æ®åŠ è½½å®Œæˆ');
        updateCover();
        
        // æ›´æ–°å½“å‰æ­Œæ›²ä¿¡æ¯
        currentSongInfo = ap.list.audios[ap.list.index];
        console.log('å½“å‰æ­Œæ›²ä¿¡æ¯:', currentSongInfo);
        
        // æ£€æŸ¥æ­Œè¯çŠ¶æ€
        setTimeout(() => {
          console.log('å½“å‰æ­Œè¯çŠ¶æ€:', {
            hasLrc: !!ap.lrc,
            lrcType: ap.options.lrcType,
            lrcVisible: lyricsVisible,
            lyricsEnabled: lyricsEnabled
          });
          
          // æ£€æŸ¥æ­Œè¯æ•°æ®
          if (ap.lrc) {
            console.log('æ­Œè¯æ•°æ®è¯¦æƒ…:', {
              hasLrcData: !!ap.lrc.lrc,
              lrcCount: ap.lrc.lrc ? Object.keys(ap.lrc.lrc).length : 0,
              hasText: !!ap.lrc.text
            });
          }
          
          // å¼ºåˆ¶æ˜¾ç¤ºæ­Œè¯
          if (ap.lrc && typeof ap.lrc.show === 'function' && !lyricsEnabled) {
            ap.lrc.show();
            lyricsEnabled = true;
          }
          
          // å°è¯•ä»å¤–éƒ¨è·å–æ­Œè¯
          if (currentSongInfo && (!ap.lrc || !ap.lrc.lrc || Object.keys(ap.lrc.lrc).length === 0)) {
            console.log('å°è¯•ä»å¤–éƒ¨è·å–æ­Œè¯...');
            fetchExternalLyrics(currentSongInfo);
          }
        }, 500);
      });
      
      ap.on('listswitch', function() {
        updateCover();
        // åˆ‡æ¢æ­Œæ›²æ—¶é‡ç½®æ­Œè¯çŠ¶æ€
        currentLyric = '';
        fallbackLyricsMode = false;
        currentSongInfo = ap.list.audios[ap.list.index];
        console.log('åˆ‡æ¢åˆ°æ­Œæ›²:', currentSongInfo);
        
        // æ–°æ­Œæ›²å°è¯•è·å–æ­Œè¯
        if (currentSongInfo) {
          setTimeout(() => {
            fetchExternalLyrics(currentSongInfo);
          }, 1000);
        }
      });
      
      ap.on('play', ()=> {
        console.log('æ’­æ”¾å¼€å§‹');
        if (capsule) capsule.classList.add('playing');
        startLyricsUpdate(ap);
      });
      
      ap.on('pause', ()=> {
        console.log('æ’­æ”¾æš‚åœ');
        if (capsule) capsule.classList.remove('playing');
        if (floatingLyrics) floatingLyrics.classList.remove('show');
        currentLyric = '';
      });
      
      ap.on('ended', ()=> {
        console.log('æ’­æ”¾ç»“æŸ');
        if (floatingLyrics) floatingLyrics.classList.remove('show');
        currentLyric = '';
      });
      
      // ç›‘å¬æ­Œè¯ç›¸å…³äº‹ä»¶
      ap.on('lrcshow', function() {
        console.log('æ­Œè¯æ˜¾ç¤ºäº‹ä»¶è§¦å‘');
        lyricsEnabled = true;
      });
      
      ap.on('lrchide', function() {
        console.log('æ­Œè¯éšè—äº‹ä»¶è§¦å‘');
        lyricsEnabled = false;
      });
    }

    // ä»å¤–éƒ¨APIè·å–æ­Œè¯
    async function fetchExternalLyrics(songInfo) {
      if (!songInfo || !songInfo.title) return;
      
      try {
        console.log('å¼€å§‹ä»å¤–éƒ¨è·å–æ­Œè¯:', songInfo.title);
        
        // æ–¹æ³•1: ä½¿ç”¨ç½‘æ˜“äº‘éŸ³ä¹API
        const searchUrl = `https://api.i-meto.com/meting/api?server=netease&type=search&id=${encodeURIComponent(songInfo.title)}`;
        const response = await fetch(searchUrl);
        const data = await response.json();
        
        if (data && data.length > 0) {
          // æ‰¾åˆ°åŒ¹é…çš„æ­Œæ›²
          const matchedSong = data.find(song => 
            song.title.includes(songInfo.title) || songInfo.title.includes(song.title)
          );
          
          if (matchedSong && matchedSong.url) {
            console.log('æ‰¾åˆ°åŒ¹é…æ­Œæ›²:', matchedSong);
            // è·å–æ­Œè¯URL
            const lyricUrl = matchedSong.lrc;
            if (lyricUrl) {
              const lyricResponse = await fetch(lyricUrl);
              const lyricText = await lyricResponse.text();
              
              if (lyricText && lyricText.trim()) {
                console.log('æˆåŠŸè·å–å¤–éƒ¨æ­Œè¯');
                // è§£æå¹¶æ˜¾ç¤ºæ­Œè¯
                parseAndDisplayLyrics(lyricText);
                return;
              }
            }
          }
        }
        
        console.log('å¤–éƒ¨APIæœªæ‰¾åˆ°æ­Œè¯ï¼Œä½¿ç”¨æ™ºèƒ½æ­Œè¯ç”Ÿæˆ');
        generateSmartLyrics(songInfo);
        
      } catch (error) {
        console.log('å¤–éƒ¨æ­Œè¯è·å–å¤±è´¥:', error);
        generateSmartLyrics(songInfo);
      }
    }

    // è§£æå¹¶æ˜¾ç¤ºæ­Œè¯
    function parseAndDisplayLyrics(lyricText) {
      try {
        const lines = lyricText.split('\n');
        const lrcMap = {};
        
        lines.forEach(line => {
          const timeMatch = line.match(/\[(\d+):(\d+\.\d+)\](.*)/);
          if (timeMatch) {
            const minutes = parseInt(timeMatch[1]);
            const seconds = parseFloat(timeMatch[2]);
            const time = minutes * 60 + seconds;
            const text = timeMatch[3].trim();
            if (text) {
              lrcMap[time] = text;
            }
          }
        });
        
        // å­˜å‚¨è§£æçš„æ­Œè¯
        window.externalLyrics = lrcMap;
        console.log('è§£æå¤–éƒ¨æ­Œè¯æˆåŠŸï¼Œè¡Œæ•°:', Object.keys(lrcMap).length);
        
      } catch (error) {
        console.log('æ­Œè¯è§£æå¤±è´¥:', error);
      }
    }

    // æ™ºèƒ½ç”Ÿæˆæ­Œè¯ï¼ˆå½“æ²¡æœ‰çœŸå®æ­Œè¯æ—¶ï¼‰
    function generateSmartLyrics(songInfo) {
      const songTitle = songInfo?.title || 'æœªçŸ¥æ­Œæ›²';
      const artist = songInfo?.author || 'æœªçŸ¥è‰ºæœ¯å®¶';
      
      const smartLyrics = {
        0: `ğŸµ ${songTitle}`,
        5: `ğŸ¤ ${artist}`,
        10: 'ğŸ¶ éŸ³ä¹æ’­æ”¾ä¸­...',
        15: 'ğŸŒŸ äº«å—è¿™ä¸€åˆ»',
        20: 'ğŸ§ æ²‰æµ¸éŸ³ä¹ä¸–ç•Œ',
        25: 'ğŸ’« èŠ‚å¥ç»§ç»­',
        30: 'ğŸµ éŸ³ä¹çš„åŠ›é‡',
        35: 'âœ¨ ç¾å¦™æ—‹å¾‹',
        40: 'ğŸ¼ è†å¬å¿ƒå£°',
        45: 'ğŸŒ™ éŸ³ä¹ç›¸ä¼´',
        50: 'ğŸ¶ ç»§ç»­æ’­æ”¾...',
        55: 'ğŸ’– éŸ³ä¹ä¸åœ'
      };
      
      window.externalLyrics = smartLyrics;
      console.log('ç”Ÿæˆæ™ºèƒ½æ­Œè¯:', smartLyrics);
    }

    // æ£€æŸ¥æ­Œè¯æ•°æ®
    function checkLyricsData(ap) {
      if (!ap || !ap.lrc) {
        console.log('APlayerå®ä¾‹æˆ–æ­Œè¯æ•°æ®ä¸å­˜åœ¨');
        return false;
      }
      
      const hasLrcData = ap.lrc.lrc && Object.keys(ap.lrc.lrc).length > 0;
      const hasTextData = ap.lrc.text && ap.lrc.text.trim().length > 0;
      const hasExternalLyrics = window.externalLyrics && Object.keys(window.externalLyrics).length > 0;
      
      console.log('æ­Œè¯æ•°æ®æ£€æŸ¥:', {
        hasLrcData: hasLrcData,
        lrcCount: hasLrcData ? Object.keys(ap.lrc.lrc).length : 0,
        hasTextData: hasTextData,
        hasExternalLyrics: hasExternalLyrics,
        externalCount: hasExternalLyrics ? Object.keys(window.externalLyrics).length : 0
      });
      
      if (!hasLrcData && !hasTextData && !hasExternalLyrics) {
        console.warn('æ²¡æœ‰å¯ç”¨çš„æ­Œè¯æ•°æ®ï¼Œå¯ç”¨å¤‡ç”¨æ–¹æ¡ˆ');
        fallbackLyricsMode = true;
        return false;
      }
      
      return hasLrcData || hasTextData || hasExternalLyrics;
    }

    // å¢å¼ºç‰ˆæ­Œè¯æ›´æ–°åŠŸèƒ½
    function startLyricsUpdate(ap) {
      if (lyricsInterval) {
        clearInterval(lyricsInterval);
      }
      
      console.log('å¼€å§‹æ­Œè¯æ›´æ–°ç›‘å¬');
      
      // å…ˆæ£€æŸ¥æ­Œè¯æ•°æ®
      if (!checkLyricsData(ap)) {
        console.log('æ²¡æœ‰æ­Œè¯æ•°æ®ï¼Œå¯ç”¨å¤‡ç”¨æ˜¾ç¤º');
        showLyricsWithEffect('ğŸµ æ­£åœ¨æ’­æ”¾...', 'ğŸ¶ äº«å—éŸ³ä¹æ—¶åˆ»');
        return;
      }
      
      lyricsInterval = setInterval(() => {
        updateLyrics(ap);
      }, 150);
    }

    function updateLyrics(ap) {
      try {
        if (!lyricsVisible) {
          if (floatingLyrics) floatingLyrics.classList.remove('show');
          return;
        }
        
        // å¦‚æœå¯ç”¨äº†å¤‡ç”¨æ¨¡å¼ï¼Œæ˜¾ç¤ºå›ºå®šæ–‡æœ¬
        if (fallbackLyricsMode) {
          showLyricsWithEffect('ğŸµ æ­£åœ¨æ’­æ”¾...', 'ğŸ¶ äº«å—éŸ³ä¹æ—¶åˆ»');
          return;
        }
        
        // æ–¹æ³•1: ä»DOMè·å–æ­Œè¯
        const domSuccess = updateLyricsFromDOM(ap);
        if (domSuccess) return;
        
        // æ–¹æ³•2: ä»APlayeræ•°æ®è·å–æ­Œè¯
        const dataSuccess = updateLyricsFromData(ap);
        if (dataSuccess) return;
        
        // æ–¹æ³•3: ä»å¤–éƒ¨æ­Œè¯è·å–
        const externalSuccess = updateLyricsFromExternal(ap);
        if (externalSuccess) return;
        
        // æ–¹æ³•4: æ˜¾ç¤ºé»˜è®¤æ–‡æœ¬
        showLyricsWithEffect('ğŸµ æ­£åœ¨æ’­æ”¾...', 'ğŸ¶ äº«å—éŸ³ä¹æ—¶åˆ»');
        
      } catch (error) {
        console.error('æ­Œè¯æ›´æ–°é”™è¯¯:', error);
        if (floatingLyrics) floatingLyrics.classList.remove('show');
        currentLyric = '';
      }
    }

    function updateLyricsFromDOM(ap) {
      try {
        let lrcContainer = document.querySelector('.aplayer-lrc');
        if (!lrcContainer) {
          lrcContainer = document.querySelector('.aplayer-lrc-contents');
        }
        if (!lrcContainer) {
          return false;
        }
        
        const currentLrc = lrcContainer.querySelector('p.aplayer-lrc-current');
        const allLrcLines = lrcContainer.querySelectorAll('p');
        
        if (currentLrc && currentLrc.textContent && currentLrc.textContent.trim()) {
          const currentText = currentLrc.textContent.trim();
          let nextText = '';
          
          // æŸ¥æ‰¾ä¸‹ä¸€è¡Œæ­Œè¯
          for (let i = 0; i < allLrcLines.length; i++) {
            if (allLrcLines[i] === currentLrc && i < allLrcLines.length - 1) {
              const nextLrc = allLrcLines[i + 1];
              if (nextLrc && nextLrc.textContent) {
                nextText = nextLrc.textContent.trim();
              }
              break;
            }
          }
          
          console.log('ä»DOMè·å–æ­Œè¯:', { current: currentText, next: nextText });
          showLyricsWithEffect(currentText, nextText);
          return true;
        }
      } catch (e) {
        console.log('ä»DOMè·å–æ­Œè¯å¤±è´¥:', e);
      }
      
      return false;
    }

    function updateLyricsFromData(ap) {
      if (!ap || !ap.lrc) return false;
      
      try {
        const currentTime = ap.audio.currentTime;
        
        // æ£€æŸ¥æ­Œè¯æ•°æ®æ ¼å¼
        if (ap.lrc.lrc && typeof ap.lrc.lrc === 'object') {
          const lrcObj = ap.lrc.lrc;
          const times = Object.keys(lrcObj).map(Number).sort((a, b) => a - b);
          
          if (times.length === 0) {
            return false;
          }
          
          let currentText = '';
          let nextText = '';
          let foundCurrent = false;
          
          for (let i = 0; i < times.length; i++) {
            if (currentTime >= times[i]) {
              currentText = lrcObj[times[i]] || '';
              foundCurrent = true;
              
              if (i < times.length - 1) {
                nextText = lrcObj[times[i + 1]] || '';
              }
            } else if (foundCurrent) {
              break;
            }
          }
          
          if (currentText && currentText.trim()) {
            console.log('ä»æ•°æ®è·å–æ­Œè¯:', { current: currentText, next: nextText });
            showLyricsWithEffect(currentText, nextText);
            return true;
          }
        }
        
        // å°è¯•è§£ææ–‡æœ¬æ ¼å¼æ­Œè¯
        if (ap.lrc.text && typeof ap.lrc.text === 'string') {
          const parsed = parseTextLyrics(ap.lrc.text, currentTime);
          if (parsed) {
            console.log('ä»æ–‡æœ¬è§£ææ­Œè¯:', parsed);
            showLyricsWithEffect(parsed.current, parsed.next);
            return true;
          }
        }
        
      } catch (e) {
        console.log('ä»æ•°æ®è·å–æ­Œè¯å¤±è´¥:', e);
      }
      
      return false;
    }

    function updateLyricsFromExternal(ap) {
      if (!ap || !window.externalLyrics) return false;
      
      try {
        const currentTime = ap.audio.currentTime;
        const lrcObj = window.externalLyrics;
        const times = Object.keys(lrcObj).map(Number).sort((a, b) => a - b);
        
        if (times.length === 0) {
          return false;
        }
        
        let currentText = '';
        let nextText = '';
        let foundCurrent = false;
        
        for (let i = 0; i < times.length; i++) {
          if (currentTime >= times[i]) {
            currentText = lrcObj[times[i]] || '';
            foundCurrent = true;
            
            if (i < times.length - 1) {
              nextText = lrcObj[times[i + 1]] || '';
            }
          } else if (foundCurrent) {
            break;
          }
        }
        
        if (currentText && currentText.trim()) {
          console.log('ä»å¤–éƒ¨è·å–æ­Œè¯:', { current: currentText, next: nextText });
          showLyricsWithEffect(currentText, nextText);
          return true;
        }
        
      } catch (e) {
        console.log('ä»å¤–éƒ¨è·å–æ­Œè¯å¤±è´¥:', e);
      }
      
      return false;
    }

    // è§£ææ–‡æœ¬æ ¼å¼æ­Œè¯
    function parseTextLyrics(lrcText, currentTime) {
      try {
        const lines = lrcText.split('\n');
        const lrcMap = {};
        
        // è§£æLRCæ ¼å¼
        lines.forEach(line => {
          const match = line.match(/\[(\d+):(\d+\.\d+)\](.*)/);
          if (match) {
            const minutes = parseInt(match[1]);
            const seconds = parseFloat(match[2]);
            const time = minutes * 60 + seconds;
            const text = match[3].trim();
            if (text) {
              lrcMap[time] = text;
            }
          }
        });
        
        const times = Object.keys(lrcMap).map(Number).sort((a, b) => a - b);
        
        if (times.length === 0) return null;
        
        let currentText = '';
        let nextText = '';
        
        for (let i = 0; i < times.length; i++) {
          if (currentTime >= times[i]) {
            currentText = lrcMap[times[i]] || '';
            
            if (i < times.length - 1) {
              nextText = lrcMap[times[i + 1]] || '';
            }
          } else {
            break;
          }
        }
        
        if (currentText) {
          return { current: currentText, next: nextText };
        }
      } catch (e) {
        console.log('è§£ææ–‡æœ¬æ­Œè¯å¤±è´¥:', e);
      }
      
      return null;
    }

    function showLyricsWithEffect(currentText, nextText) {
      if (!lyricsVisible || !currentLineEl || !nextLineEl) return;
      if (currentText === currentLyric) return;
      
      currentLyric = currentText;
      currentLineEl.textContent = currentText;
      nextLineEl.textContent = nextText || '';
      
      if (currentText && currentText.trim() && floatingLyrics) {
        floatingLyrics.classList.add('show');
      } else if (floatingLyrics) {
        floatingLyrics.classList.remove('show');
      }
    }

    // å³é”®èœå•åŠŸèƒ½ï¼ˆä¿æŒä¸å˜ï¼‰
    function showRightMenuAt(clientX, clientY){
      if (!rightMenu) return;
      
      rightMenu.style.display = 'block';
      rightMenu.classList.remove('show');
      requestAnimationFrame(()=>{
        const mw = rightMenu.offsetWidth || 220;
        const mh = rightMenu.offsetHeight || 280;
        let left = Math.round(clientX - mw/2);
        left = Math.max(8, Math.min(left, window.innerWidth - mw - 8));
        let top = clientY - mh - 12;
        if (top < 8) top = clientY + 12;
        if (top + mh > window.innerHeight - 8) top = Math.max(8, window.innerHeight - mh - 8);
        rightMenu.style.left = left + 'px';
        rightMenu.style.top = top + 'px';
        const arrowLeft = Math.max(12, Math.min(clientX - left, mw - 12));
        rightMenu.style.setProperty('--arrow-left', arrowLeft + 'px');
        rightMenu.classList.add('show');
      });
    }

    function hideRightMenuImmediate(){
      if (!rightMenu) return;
      rightMenu.classList.remove('show');
      rightMenu.style.display = 'none';
    }

    // æ­Œè¯æ˜¾ç¤º/éšè—æ§åˆ¶
    function toggleLyricsVisibility() {
      lyricsVisible = !lyricsVisible;
      
      if (lyricsVisible) {
        if (floatingLyrics) floatingLyrics.classList.add('show');
        if (aplayer && !aplayer.audio.paused) {
          startLyricsUpdate(aplayer);
        }
        // å¼ºåˆ¶æ˜¾ç¤ºAPlayeræ­Œè¯
        if (aplayer && aplayer.lrc && typeof aplayer.lrc.show === 'function') {
          aplayer.lrc.show();
          lyricsEnabled = true;
        }
      } else {
        if (floatingLyrics) {
          floatingLyrics.classList.remove('show');
          currentLineEl.textContent = '';
          nextLineEl.textContent = '';
        }
        currentLyric = '';
      }
      
      const lyricsMenuItem = document.getElementById('menu-lyrics');
      if (lyricsMenuItem) {
        lyricsMenuItem.textContent = lyricsVisible ? 'ğŸ“œ éšè—æ­Œè¯' : 'ğŸ“œ æ˜¾ç¤ºæ­Œè¯';
      }
      localStorage.setItem('lyricsVisible', lyricsVisible.toString());
    }

    // æ’­æ”¾æ§åˆ¶å‡½æ•°ï¼ˆä¿æŒä¸å˜ï¼‰
    function getAPlayerInstance() {
      return aplayer;
    }

    function togglePlay() {
      if (aplayer) {
        aplayer.toggle();
      }
    }

    function prevSong() {
      if (aplayer) aplayer.skipBack();
    }

    function nextSong() {
      if (aplayer) aplayer.skipForward();
    }

    function volumeUp() {
      if (aplayer) {
        const newVolume = Math.min((aplayer.audio.volume || 0.7) + 0.1, 1);
        aplayer.volume(newVolume, true);
      }
    }

    function volumeDown() {
      if (aplayer) {
        const newVolume = Math.max((aplayer.audio.volume || 0.7) - 0.1, 0);
        aplayer.volume(newVolume, true);
      }
    }

    // æ–°å¢åŠŸèƒ½ï¼šéšæœºè·³è½¬å’Œå›ä¸»é¡µ
    function randomNavigate() {
      // è¿™é‡Œå¯ä»¥æ›¿æ¢ä¸ºæ‚¨åšå®¢çš„å®é™…æ–‡ç« é“¾æ¥æ•°ç»„
      const randomPages = [
        '/posts/git-pic-ver',
        '/posts/hexo-one', 
        '/posts/lizhi',
        '/posts/markdown-mermaid',
        '/posts/jiaoyizhidao'
        // æ·»åŠ æ›´å¤šæ–‡ç« é“¾æ¥...
      ];
      
      // å¦‚æœæ²¡æœ‰å®šä¹‰é¡µé¢æ•°ç»„ï¼Œä½¿ç”¨ä¸€ä¸ªç®€å•çš„éšæœºè·³è½¬é€»è¾‘
      if (randomPages && randomPages.length > 0) {
        const randomIndex = Math.floor(Math.random() * randomPages.length);
        window.location.href = randomPages[randomIndex];
      } else {
        // å¤‡ç”¨æ–¹æ¡ˆï¼šè·³è½¬åˆ°éšæœºæ–‡ç« é¡µé¢æˆ–å½’æ¡£é¡µé¢
        window.location.href = '/archives';
      }
    }

    function goHome() {
      window.location.href = '/';
    }

    // å¯¼èˆªå›¾æ ‡åŠŸèƒ½
    function navBack() {
      window.history.back();
      hideRightMenuImmediate();
    }

    function navForward() {
      window.history.forward();
      hideRightMenuImmediate();
    }

    function navRefresh() {
      window.location.reload();
      hideRightMenuImmediate();
    }

    function navTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      hideRightMenuImmediate();
    }

    // è¾…åŠ©å‡½æ•°
    async function ensurePlayerAndRun(fn){
      try {
        const ap = await initMeting();
        if (typeof fn === 'function') fn(ap);
      } catch(err){
        console.warn('æ’­æ”¾å™¨æœªå°±ç»ªï¼š', err);
      }
    }

    // äº‹ä»¶ç›‘å¬ï¼ˆä¿æŒä¸å˜ï¼‰
    document.addEventListener('DOMContentLoaded', function() {
      // åˆå§‹åŒ–æ­Œè¯æ˜¾ç¤ºçŠ¶æ€
      const savedLyricsVisible = localStorage.getItem('lyricsVisible');
      if (savedLyricsVisible !== null) {
        lyricsVisible = savedLyricsVisible === 'true';
      }
      
      const lyricsMenuItem = document.getElementById('menu-lyrics');
      if (lyricsMenuItem) {
        lyricsMenuItem.textContent = lyricsVisible ? 'ğŸ“œ éšè—æ­Œè¯' : 'ğŸ“œ æ˜¾ç¤ºæ­Œè¯';
      }
      
      if (!lyricsVisible && floatingLyrics) {
        floatingLyrics.classList.remove('show');
      }
      
      // èƒ¶å›Šç‚¹å‡»äº‹ä»¶
      if (capsule) {
        capsule.addEventListener('click', ()=>{
          if (playerWrap) {
            playerWrap.classList.add('show');
            initMeting().then(ap => {
              console.log('APlayeråˆå§‹åŒ–å®Œæˆ');
            }).catch((err)=>{
              console.log('APlayeråˆå§‹åŒ–å¤±è´¥:', err);
            });
          }
        });
      }
      
      // å³é”®èœå•äº‹ä»¶
      document.addEventListener('contextmenu', (e) => {
        if (e.ctrlKey) return;
        e.preventDefault();
        showRightMenuAt(e.clientX, e.clientY);
      });
      
      document.addEventListener('click', (e) => {
        if (rightMenu && !rightMenu.contains(e.target)) {
          hideRightMenuImmediate();
        }
      });
      
      // èœå•åŠŸèƒ½ç»‘å®š
      const menuPlay = document.getElementById('menu-play');
      const menuPrev = document.getElementById('menu-prev');
      const menuNext = document.getElementById('menu-next');
      const menuVolup = document.getElementById('menu-volup');
      const menuVoldown = document.getElementById('menu-voldown');
      const menuLyrics = document.getElementById('menu-lyrics');
      // æ–°å¢çš„ä¸¤ä¸ªèœå•é¡¹
      const menuRandom = document.getElementById('menu-random');
      const menuHome = document.getElementById('menu-home');
      const menuSupport = document.getElementById('menu-support');
      const menuFullscreen = document.getElementById('menu-fullscreen');
      const menuClose = document.getElementById('menu-close');
      
      // å¯¼èˆªå›¾æ ‡åŠŸèƒ½ç»‘å®š
      const navBackBtn = document.getElementById('nav-back');
      const navForwardBtn = document.getElementById('nav-forward');
      const navRefreshBtn = document.getElementById('nav-refresh');
      const navTopBtn = document.getElementById('nav-top');

      if (menuPlay) menuPlay.addEventListener('click', ()=>{ ensurePlayerAndRun(ap=>ap.toggle()); hideRightMenuImmediate(); });
      if (menuPrev) menuPrev.addEventListener('click', ()=>{ ensurePlayerAndRun(ap=>ap.skipBack()); hideRightMenuImmediate(); });
      if (menuNext) menuNext.addEventListener('click', ()=>{ ensurePlayerAndRun(ap=>ap.skipForward()); hideRightMenuImmediate(); });
      if (menuVolup) menuVolup.addEventListener('click', ()=>{ volumeUp(); hideRightMenuImmediate(); });
      if (menuVoldown) menuVoldown.addEventListener('click', ()=>{ volumeDown(); hideRightMenuImmediate(); });
      if (menuLyrics) menuLyrics.addEventListener('click', ()=>{ toggleLyricsVisibility(); hideRightMenuImmediate(); });
      // æ–°å¢çš„èœå•äº‹ä»¶
      if (menuRandom) menuRandom.addEventListener('click', ()=>{ 
        randomNavigate(); 
        hideRightMenuImmediate(); 
      });
      if (menuHome) menuHome.addEventListener('click', ()=>{ 
        goHome(); 
        hideRightMenuImmediate(); 
      });
      if (menuSupport) menuSupport.addEventListener('click', ()=>{ window.open('https://1356666.xyz','_blank'); hideRightMenuImmediate(); });
      if (menuFullscreen) menuFullscreen.addEventListener('click', ()=>{ 
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen().catch(()=>{});
        } else {
          document.exitFullscreen().catch(()=>{});
        }
        hideRightMenuImmediate();
      });
      if (menuClose) menuClose.addEventListener('click', ()=>{ 
        ensurePlayerAndRun(ap=>ap.pause()); 
        if (playerWrap) playerWrap.classList.remove('show');
        hideRightMenuImmediate(); 
      });
      
      // å¯¼èˆªå›¾æ ‡äº‹ä»¶
      if (navBackBtn) navBackBtn.addEventListener('click', navBack);
      if (navForwardBtn) navForwardBtn.addEventListener('click', navForward);
      if (navRefreshBtn) navRefreshBtn.addEventListener('click', navRefresh);
      if (navTopBtn) navTopBtn.addEventListener('click', navTop);

      // é¢„åˆå§‹åŒ–
      setTimeout(() => {
        initMeting().then(ap=>{
          console.log('APlayeré¢„åˆå§‹åŒ–å®Œæˆ');
        }).catch((err)=>{
          console.log('APlayeré¢„åˆå§‹åŒ–å¤±è´¥:', err);
        });
      }, 1000);
    });

    // åŠ è½½å¿…è¦çš„è„šæœ¬
    function loadScripts() {
      return new Promise((resolve) => {
        if (window.APlayer && window.customElements?.get("meting-js")) {
          resolve();
          return;
        }

        let scriptsLoaded = 0;
        const totalScripts = 2;

        function checkAllLoaded() {
          scriptsLoaded++;
          if (scriptsLoaded === totalScripts) {
            resolve();
          }
        }

        // åŠ è½½ APlayer
        if (!window.APlayer) {
          const aplayerScript = document.createElement("script");
          aplayerScript.src = aplayerJsPath;
          aplayerScript.async = true;
          aplayerScript.onload = checkAllLoaded;
          aplayerScript.onerror = checkAllLoaded;
          document.head.appendChild(aplayerScript);
        } else {
          checkAllLoaded();
        }

        // åŠ è½½ MetingJS
        if (!window.customElements?.get("meting-js")) {
          const metingScript = document.createElement("script");
          metingScript.src = metingJsPath;
          metingScript.async = true;
          metingScript.onload = checkAllLoaded;
          metingScript.onerror = checkAllLoaded;
          document.head.appendChild(metingScript);
        } else {
          checkAllLoaded();
        }
      });
    }

    // å¯åŠ¨
    loadScripts().then(() => {
      console.log('éŸ³ä¹æ’­æ”¾å™¨è„šæœ¬åŠ è½½å®Œæˆ');
    });
  })();
</script>

<style is:global>
 /* ===== æ’­æ”¾å™¨é¢æ¿ï¼ˆç‚¹å‡»èƒ¶å›Šå±•å¼€ï¼‰ ===== */
  #player-wrap {
    position: fixed;
    left: 18px;
    bottom: 92px;
    width: 360px;
    max-width: calc(100% - 36px);
    z-index: 15000;
    display: none;
    transform-origin: left bottom;
  }
  #player-wrap.show {
    display: block;
    animation: popIn .18s ease;
  }
  @keyframes popIn {
    from { opacity: 0; transform: scale(.96) }
    to { opacity: 1; transform: scale(1) }
  }

  /* APlayer å¾®è°ƒæ ·å¼ */
  .aplayer { 
    border-radius: 12px !important; 
    overflow: hidden !important; 
  }
  .aplayer .aplayer-lrc p { 
    color: orange !important; 
    font-weight: 700; 
  }

  /* ===== éŸ³ä¹æ’­æ”¾å™¨æ ·å¼ä¿®æ”¹ ===== */
  /* é¡¶éƒ¨æ­Œæ›²åæ”¹ä¸ºé»‘è‰² */
  .aplayer .aplayer-info .aplayer-music .aplayer-title {
    color: #000 !important;
    font-weight: bold;
  }

  /* æ’­æ”¾åˆ—è¡¨æ­Œåæ”¹ä¸ºé»‘è‰² */
  .aplayer .aplayer-list ol li {
    color: #000 !important;
  }

  .aplayer .aplayer-list ol li .aplayer-list-title {
    color: #000 !important;
  }

  /* æ­Œè¯æ”¹ä¸ºæ©™è‰² */
  .aplayer .aplayer-lrc p {
    color: #ff8c00 !important;
  }

  .aplayer .aplayer-lrc p.aplayer-lrc-current {
    color: #ff4500 !important;
    font-weight: bold;
    font-size: 16px;
  }

  /* æ’­æ”¾å™¨æ•´ä½“æ ·å¼è°ƒæ•´ */
  .aplayer {
    background: rgba(255, 255, 255, 0.9) !important;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }

 /* ç‹¬ç«‹æ­Œè¯æ˜¾ç¤ºæ ·å¼ */
.floating-lyrics {
  position: fixed;
  left: 100px;
  bottom: 50px;
  text-align: left;
  z-index: 99999;
  color: #0066cc; /* é“å¥‡è“ä»£æ›¿æ©™è‰² */
  font-size: 18px;
  font-weight: bold;
  /* ç§»é™¤ text-shadow */
  background: rgba(255, 255, 255, 0.10);
  padding: 15px 20px;
  border-radius: 12px;
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  max-width: 400px;
  opacity: 0;
  transition: opacity 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.1);
  pointer-events: none;
  display: none;
}

.floating-lyrics.show {
  opacity: 1;
  display: block;
}

.floating-lyrics .current-line {
  color: #006400; /* æ·±è“è‰²ä»£æ›¿æ·±ç»¿è‰²#006400 */
  font-size: 30px;
  margin-bottom: 8px;
  font-weight: bold;
  min-height: 24px;
}

.floating-lyrics .next-line {
  color: #0066cc; /* æ·±è“ä»£æ›¿æ©™è‰² */
  font-size: 18px;
  opacity: 0.8;
  min-height: 18px;
}

 /* ===== éŸ³ä¹èƒ¶å›Šï¼ˆå›ºå®šå·¦ä¸‹ï¼‰ ===== */
  .music-capsule {
    position: fixed;
    left: 22px;
    bottom: 96px;
    width: 72px;
    height: 72px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 30000;
    background: radial-gradient(circle at 30% 30%, #00c3ff, #0061ff);
    box-shadow: 0 8px 28px rgba(0, 180, 255, 0.12);
  }

  .music-capsule:hover {
    transform: scale(1.05);
  }

  .music-capsule img {
    width: 64%;
    height: 64%;
    border-radius: 50%;
    object-fit: cover;
    transition: transform 0.3s;
  }

  .music-capsule.playing {
    background: radial-gradient(circle at 30% 30%, #ff9500, #ff5e00);
    box-shadow: 0 8px 28px rgba(255, 140, 0, 0.28);
  }

  .music-capsule.playing img {
    animation: spin 6s linear infinite;
  }

  @keyframes spin {
    from { transform: rotate(0) }
    to { transform: rotate(360deg) }
  }

  /* æ–¹æ¡ˆäºŒï¼šæ‹Ÿç‰©é»‘èƒ¶é£ */
  .vinyl-arm {
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    width: 90px;
    height: 70px;
    z-index: 10;
    pointer-events: none;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }

  .arm-base {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 16px;
    height: 25px;
    background: linear-gradient(135deg, #8b8b8b, #4a4a4a, #8b8b8b);
    border-radius: 4px 4px 2px 2px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    border: 1px solid #5a5a5a;
  }

  .arm-rod {
    position: absolute;
    top: 25px;
    left: 50%;
    width: 3px;
    height: 45px;
    background: linear-gradient(to bottom, #c0c0c0, #808080, #505050);
    transform-origin: top center;
    transform: translateX(-50%) rotate(-25deg);
    transition: transform 0.8s cubic-bezier(0.34, 1.2, 0.64, 1);
    border-radius: 1px;
  }

  .arm-head {
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 12px;
    height: 12px;
    background: linear-gradient(135deg, #333, #000);
    border-radius: 50%;
    transform: translateX(-50%);
    box-shadow: 0 1px 6px rgba(0,0,0,0.6), 
          inset 0 1px 1px rgba(255,255,255,0.2);
    border: 1px solid #000;
  }

  /* æ’­æ”¾çŠ¶æ€ */
  .music-capsule.playing .vinyl-arm .arm-rod {
    transform: translateX(-50%) rotate(25deg);
  }

/* ===== å³é”®èœå•ï¼ˆæ¯›ç»ç’ƒåŠé€æ˜ï¼‰ ===== */
#right-menu {
  position: fixed;
  display: none;
  z-index: 40000;
  min-width: 220px;
  background: rgba(255,255,255,0.12);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  color: #008000;
  border-radius: 10px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.35);
  padding: 6px 0;
  opacity: 0;
  transform: scale(.98);
  transition: opacity .12s,transform .12s;
}
#right-menu.show {
  display: flex;
  opacity: 1;
  transform: scale(1);
  flex-direction: column;
}

/* å¯¼èˆªå›¾æ ‡æ  - å®Œå…¨é‡å†™ */
#right-menu .nav-icons {
  display: flex;
  justify-content: space-between;
  padding: 12px 16px;
  border-bottom: 1px solid rgba(255,255,255,0.2);
  margin-bottom: 4px;
  background: transparent !important;
  border-radius: 8px 8px 0 0;
  gap: 8px;
}

/* æ¯ä¸ªå¯¼èˆªå›¾æ ‡ç‹¬ç«‹å®¹å™¨ */
#right-menu .nav-icons .nav-icon {
  font-size: 22px !important;
  font-weight: 900 !important;
  color: #008000 !important;
  cursor: pointer;
  padding: 10px !important;
  border-radius: 8px !important;
  transition: all 0.2s ease !important;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 44px !important;
  height: 44px !important;
  background: rgba(255, 255, 255, 0.08) !important;
  border: 1px solid rgba(255, 255, 255, 0.15) !important;
  margin: 0 !important;
  flex: 0 0 auto !important;
}

/* æ‚¬åœæ•ˆæœ - å¼ºåˆ¶ç‹¬ç«‹ */
#right-menu .nav-icons .nav-icon:hover {
  background: #10b981 !important;
  color: white !important;
  transform: scale(1.15) !important;
  border-color: #10b981 !important;
  box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4) !important;
}

#right-menu li {
  list-style: none;
  padding: 10px 16px;
  cursor: pointer;
  white-space: nowrap;
  font-weight: 700;
  transition: background .12s, color .12s;
}
#right-menu li:hover {
  background: #10b981 !important;
  color: white !important;
  border-radius: 6px;
}
#right-menu::after {
  content: "";
  position: absolute;
  top: -8px;
  left: var(--arrow-left,24px);
  transform: translateX(-50%);
  border-left: 8px solid transparent;
  border-right: 8px solid transparent;
  border-bottom: 8px solid rgba(255,255,255,0.12);
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
  .music-capsule {
    left: 18px;
    bottom: 22px;
    width: 60px;
    height: 60px;
  }
  
  .floating-lyrics {
    left: 90px;
    bottom: 30px;
    max-width: 250px;
    font-size: 16px;
  }
  
  .floating-lyrics .current-line {
    font-size: 18px;
  }
  
  .floating-lyrics .next-line {
    font-size: 12px;
  }
  
  #player-wrap {
    width: calc(100vw - 36px);
    max-width: 360px;
  }
  
  /* ç§»åŠ¨ç«¯å¯¼èˆªå›¾æ ‡ */
  #right-menu .nav-icons .nav-icon {
    font-size: 20px !important;
    width: 40px !important;
    height: 40px !important;
    padding: 8px !important;
  }
  
  #right-menu .nav-icons .nav-icon:hover {
    transform: scale(1.1) !important;
  }
  
  /* ç§»åŠ¨ç«¯å³é”®èœå•æ‚¬åœæ•ˆæœ */
  #right-menu li:hover {
    background: #10b981 !important;
    color: white !important;
    border-radius: 6px;
  }
}

/* ç§»åŠ¨ç«¯éšè— */
.mobile-hide {
  display: none !important;
}
</style>
