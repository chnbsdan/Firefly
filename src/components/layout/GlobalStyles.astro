---
// src/components/layout/GlobalStyles.astro
---

<style is:global>
  /* 基础全局样式 - 最小化干预 */
  :root {
    --primary-color: #3b82f6;
    --secondary-color: #64748b;
    --accent-color: #f59e0b;
  }

  /* 重置样式 */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    scroll-behavior: smooth;
  }

  /* 确保页面没有白色背景块 */
  body {
    background-color: transparent !important;
    position: relative;
    min-height: 100vh;
  }

  /* 确保 Astro 容器也没有白色背景 */
  #__astro {
    background-color: transparent !important;
  }

  /* 隐藏可能存在的白色背景元素 */
  [style*="background-color: white"],
  [style*="background-color: #fff"],
  [style*="background-color: #ffffff"] {
    background-color: transparent !important;
  }

  /* 滚动条样式 */
  ::-webkit-scrollbar {
    width: 8px;
  }

  ::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
  }

  ::-webkit-scrollbar-thumb {
    background: var(--secondary-color);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--primary-color);
  }
</style>

<script is:inline>
/* 修复版的鼠标点击特效 */
document.addEventListener('DOMContentLoaded', function() {
  var a_idx = 0;
  var texts = ["天真", "富强", "民主", "文明", "和谐", "自由", "平等", "公正", "法治", "爱国", "敬业", "诚信", "友善"];
  var activeEffects = 0;
  var maxEffects = 5;

  // 延迟初始化，确保页面完全加载
  setTimeout(function() {
    // 移除可能存在的白色背景
    removeWhiteBackgrounds();
    
    // 绑定点击事件
    document.addEventListener('click', function(e) {
      // 限制同时显示的特效数量
      if (activeEffects >= maxEffects) return;
      
      activeEffects++;
      
      var span = document.createElement('span');
      span.textContent = texts[a_idx];
      a_idx = (a_idx + 1) % texts.length;
      
      var x = e.clientX;
      var y = e.clientY;
      
      Object.assign(span.style, {
        zIndex: '2147483647',
        top: (y - 20) + 'px',
        left: x + 'px',
        position: 'fixed',
        fontWeight: 'bold',
        color: '#ff6651',
        fontSize: '22px',
        fontFamily: 'Microsoft YaHei, SimHei, sans-serif',
        textShadow: '2px 2px 6px rgba(0,0,0,0.4)',
        pointerEvents: 'none',
        userSelect: 'none',
        whiteSpace: 'nowrap',
        willChange: 'transform, opacity'
      });
      
      document.body.appendChild(span);
      
      const animation = span.animate([
        { 
          transform: 'translateY(0) scale(1)', 
          opacity: 1 
        },
        { 
          transform: 'translateY(-180px) scale(1.3)', 
          opacity: 0 
        }
      ], {
        duration: 1800,
        easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
      });
      
      animation.onfinish = function() {
        activeEffects--;
        if (span.parentNode) {
          span.parentNode.removeChild(span);
        }
      };
    });

    console.log('鼠标点击特效已加载 - 背景修复版本');
  }, 100);

  // 移除白色背景的函数
  function removeWhiteBackgrounds() {
    // 检查 body 背景
    if (getComputedStyle(document.body).backgroundColor === 'rgb(255, 255, 255)') {
      document.body.style.backgroundColor = 'transparent';
    }
    
    // 检查 html 背景
    if (getComputedStyle(document.documentElement).backgroundColor === 'rgb(255, 255, 255)') {
      document.documentElement.style.backgroundColor = 'transparent';
    }
    
    // 检查 Astro 容器
    const astroContainer = document.getElementById('__astro');
    if (astroContainer && getComputedStyle(astroContainer).backgroundColor === 'rgb(255, 255, 255)') {
      astroContainer.style.backgroundColor = 'transparent';
    }
    
    // 查找其他可能有白色背景的元素
    const allElements = document.querySelectorAll('*');
    allElements.forEach(el => {
      const bgColor = getComputedStyle(el).backgroundColor;
      if (bgColor === 'rgb(255, 255, 255)' || bgColor === 'white') {
        el.style.backgroundColor = 'transparent';
      }
    });
  }

  // 监听页面变化（Astro 路由）
  document.addEventListener('astro:page-load', function() {
    setTimeout(removeWhiteBackgrounds, 200);
  });
});
</script>
